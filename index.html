<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>the day of sign</title>
	<meta name ="keywords" content="Sign,ccx01,sign,the day of sign,signXday,沙因,游戏,银河,宇宙,时间">
	<meta name="description" content="just for fun,及时行乐,核心思路是以时间空间为基础元素进行制作">
	<link rel="stylesheet" href="/lv9/css/main.css"></head>
<body>
	<!-- <div class="loading">loading</div>
-->
<div id="main">
	<ul class="navi">
		<li class="item">menu1</li>
		<li class="item">menu1</li>
		<li class="item">menu1</li>
		<li class="item">menu1</li>
	</ul>
	<div class="layer l1"></div>
	<div class="layer l2"></div>
	<div class="layer l3"></div>
	<div class="layer l4"></div>
</div>
<script type="text/template" id="tpl">
	<div class="item">
		<span class="num">{#n}</span>
	</div>
</script>
<script>
	var tpl = document.querySelector('#tpl').innerHTML;
	var sign = ["Ⅰ", "Ⅱ", "Ⅲ", "Ⅳ", "Ⅴ", "Ⅵ", "Ⅶ", "Ⅷ", "Ⅸ", "Ⅹ", "Ⅺ", "Ⅻ"];
	var l1 = function(){
		var items = initHTML('.l1', 12);
		circle(items, 270, 80, l2);
	}
	var l2 = function(){
		var items = initHTML('.l2', 24);
		circle(items, 340, 80, l3);
	}
	var l3 = function(){
		var items = initHTML('.l3', 36);
		circle(items, 450, 50, l4);
	}
	var l4 = function(){
		var items = initHTML('.l4', 48);
		circle(items, 550, 50, function(){
			document.querySelector('.navi').className += ' active';
		});
	}

	l1();

	function initHTML(layer, num){
		var dom = document.querySelector(layer);
		var html = '';
		for (var i = 0; i < num; i++) {
			data = {n: sign[i % sign.length]};
			html += tplEngine(tpl, data);
		}
		dom.innerHTML = html;
		return dom.querySelectorAll('.item');
	}

	function circle(items, r, t, callback){
		var x;
		var y;
		var rotate;
		var deg = 360 / items.length;
		if(typeof(t) == 'function'){
			var callback = t;
			var t = 100;
		}else{
			var callback = callback || function(){};
			var t = t || 100;
		}
		(function fn(i){
			if(i < items.length){
				setTimeout(function(){
					x =  (i == items.length * 0.5) ? 0 : Math.sin(i * 2 * Math.PI / items.length) * r;
					y =  (i == items.length * 0.75) ? 0 : -Math.cos(i * 2 *  Math.PI / items.length) * r;
					rotate = deg * i;
					items[i].style.transform = 'translate3d(' + x + 'px, ' + y + 'px, 0) rotate(' + rotate + 'deg)';
					items[i].style.opacity = 1;
					fn(i + 1);
				}, t);
			}else{
				callback();
			}
		}(0));
	}

	function tplEngine(tpl, data) {
		var re = /{#(\w+)?}/;
		while(match = re.exec(tpl)) {
			tpl = tpl.replace(match[0],data[match[1]]);
		}
		return tpl;
	}
</script>
</body>
</html>